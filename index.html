<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>index</title>
    <link rel="stylesheet" href="/css/final.css">
    <link rel="stylesheet" href="/js/wallet.js">

    <script src="https://cdn.jsdelivr.net/npm/web3@1.5.2/dist/web3.min.js"></script>
    <!----favicon-->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
</head>
<body>
    
     <!--------------------NAVBAR---------------------->
     <div class="nav">
        <ul>
            <li><a href="#">Home</a></li>
            <li><a href="#">Documents</a></li>
            <li><a href="#">Upload </a></li>
            <li><a href="#" id="right" >Sign In</a></li>
            <li><button id="wallet" onclick = "metamask()">connect</button></li>
          </ul>
          
        </div>
    


        <!------- carousel ------>

        <section class="carousel">
            <div class="carousel_slider">
              <div class="content_inner_slider">
                <img src="SLIDER1.jpg" alt="" class="img">
                <img src="SLIDER2.jpg" alt="" class="img">
                <img src="standard-quality-control-concept-m.jpg" alt="" class="img">
                <img src="SLIDER1.jpg"" class="img">
                <img src="SLIDER2.jpg" alt="" class="img">
              </div>
              <button class="prev_button">
                <ion-icon name="chevron-back-outline"></ion-icon>
              </button>
              <button class="next_button">
                <ion-icon name="chevron-forward-outline"></ion-icon>
              </button>
            </div>
            <ul class="dots">
              <li class="dot" value="0"></li>
              <li class="dot" value="1"></li>
              <li class="dot" value="2"></li>
              <li class="dot" value="3"></li>
              <li class="dot" value="4"></li>
            </ul>
            <div class="form">
              <input type="checkbox" class="auto_slide" id="slide">
              <label for="slide">Auto Slide</label>
            </div>
          </section>
          <script src="./app.js"></script>
      

    
    
    


         <!-------documents carousel ------>

            <div class="docs">

                <div class="heading">
                    Your Documents
                   
                </div>


                <!-----------search bar ---------->

                <div class="wrap">
                    <div class="search">
                       <input type="text" class="searchTerm" placeholder="">
                       <button type="submit" class="searchButton">
                         <i class="fa fa-search"></i>
                      </button>
                    </div>
                 </div>
         
   
    <div id="slider-container" class="slider">
     
      

        <div class="slide">
          <div style="background-color:#dbf3ff;width:300px;height: 250px;border-radius: 5px; text-align:center;padding:7px;">
            <h3 style="text-align: left;">Document.pdf</h3>
            <div style="text-align:center;padding:2px; margin:0 auto">
              <img src="/download.jpg" height="200px"; alt="" style="padding-top:5px;">
            </div>
            </div>
        </div>
        <div class="slide">
          <div style="background-color:#dbf3ff;width:300px;height: 250px;text-align:center;padding:7px;border-radius: 5px; ">
            <h3 style="text-align: left;">Document.pdf</h3>
            <div style="text-align:center;padding:2px; margin:0 auto">
              <img src="/download.jpg" height="200px"; alt="" style="padding-top:5px;">
            </div>
            </div>
        </div>
  
        <div class="slide">
          <div style="background-color:#dbf3ff;width:300px;height: 250px;text-align:center;padding:7px;border-radius: 5px; ">
            <h3 style="text-align: left;">Document.pdf</h3>
            <div style="text-align:center;padding:2px; margin:0 auto">
              <img src="/download.jpg" height="200px"; alt="" style="padding-top:5px;">
            </div>
            </div>
        </div>
  
        <div class="slide">
          <div style="background-color:#dbf3ff;width:300px;height: 250px;text-align:center;padding:7px;border-radius: 5px; ">
            <h3 style="text-align: left;">Document.pdf</h3>
            <div style="text-align:center;padding:2px; margin:0 auto">
              <img src="/download.jpg" height="200px"; alt="" style="padding-top:5px;">
            </div>
            </div>
        </div>
  
        <div class="slide">
          <div style="background-color:#dbf3ff;width:300px;height: 250px;text-align:center;padding:7px;border-radius: 5px; ">
            <h3 style="text-align: left;">Document.pdf</h3>
            <div style="text-align:center;padding:2px; margin:0 auto">
              <img src="/download.jpg" height="200px"; alt="" style="padding-top:5px;">
            </div>
            </div>
        </div>
  
  
  
        <div class="slide">
          <div style="background-color:#dbf3ff;width:300px;height: 250px;text-align:center;padding:7px;border-radius: 5px;">
            <h3 style="text-align: left;">Document.pdf</h3>
            <div style="text-align:center;padding:2px; margin:0 auto">
              <img src="/download.jpg" height="200px"; alt="" style="padding-top:5px;">
            </div>
            </div>
        </div>
  
        <div class="slide">
          <div style="background-color:#dbf3ff;width:300px;height: 250px;text-align:center;padding:7px;border-radius: 5px;">
            <h3 style="text-align: left;">Document.pdf</h3>
            <div style="text-align:center;padding:2px; margin:0 auto">
              <img src="/download.jpg" height="200px"; alt="" style="padding-top:5px;">
            </div>
            </div>
        </div>
        
  
        <div class="slide">
          <div style="background-color:#dbf3ff;width:300px;height: 250px;text-align:center;padding:7px;border-radius: 5px;">
            <h3 style="text-align: left;">Document.pdf</h3>
            <div style="text-align:center;padding:2px; margin:0 auto">
              <img src="/download.jpg" height="200px"; alt="" style="padding-top:5px;">
            </div>
            </div>
        </div>
  
        <div class="slide">
          <div style="background-color:#dbf3ff;width:300px;height: 250px;text-align:center;padding:7px;border-radius: 5px;">
            <h3 style="text-align: left;">Document.pdf</h3>
            <div style="text-align:center;padding:2px; margin:0 auto">
              <img src="/download.jpg" height="200px"; alt="" style="padding-top:5px;">
            </div>
            </div>
        </div>
        
        
  
        
        <div onclick="prev()" class="control-prev-btn">
           <i class="fas fa-arrow-left"></i>
        </div>
        <div onclick="next()" class="control-next-btn">
          <i class="fas fa-arrow-right"></i>
        </div>
      </div>
      
      
      <div class="overlay"></div>
  
            </div>




            <!-----------------Upload BUtton ------------->
            <div class="btn">

              <h1>Upload PDF to IPFS</h1>
              <input type="file" id="pdfInput">
              <button onclick="uploadPDF()">Upload</button>
              <p id="status"></p>
            </div>



            <!---------------footer------------------------>
            <div class="footer">


            </div>








































    <script>

        function prev(){
                document.getElementById('slider-container').scrollLeft -= 470;
        }
        
        function next()
        {
                document.getElementById('slider-container').scrollLeft += 470;
        }
        
        
        $(".slide img").on("click" , function(){
            $(this).toggleClass('zoomed');
            $(".overlay").toggleClass('active');
        })
        
            </script>

<script>
    // The code will be long
  // because I want to use MVC Design Pattern for this.
  
  window.onload = function () {
    const helpers = (function () {
      function getDOMElements(DOMSelectors) {
        let DOMElements = {};
        for (let selector in DOMSelectors) {
          if (DOMSelectors.hasOwnProperty(selector)) {
            DOMElements[selector] = document.querySelector(
              DOMSelectors[selector]
            );
          }
        }
        return DOMElements;
      }
      return {
        getDOMElements
      };
    })();
  
    const modal = (function () {
      const state = {
        counter: 0,
        intervalID: 0
      };
      let CONSTANTS = {
        ACTIVE_CLASS_NAME: "active",
        TIMER: 1500,
        TRANSITION: "all .3s ease-out"
      };
      function addConstant(key, value) {
        CONSTANTS[key] = value;
      }
  
      return {
        state,
        CONSTANTS,
        addConstant
      };
    })();
  
    const view = (function (helpers) {
      const DOMSelectors = {
        carouselInnerSlider: ".content_inner_slider",
        dots: ".dots",
        slide: "#slide",
        prevButton: ".prev_button",
        nextButton: ".next_button",
        carouselImages: ".content_inner_slider > img",
        dot: ".dot"
      };
      const DOMElements = helpers.getDOMElements(DOMSelectors);
      const CAROUSEL_IMAGES = [
        ...document.querySelectorAll(DOMSelectors.carouselImages)
      ];
      const DOTS = [...document.querySelectorAll(DOMSelectors.dot)];
      function moveSliderToIndex(IMAGE_SIZE, index) {
        DOMElements.carouselInnerSlider.style.transform = `translateX(-${
          IMAGE_SIZE * index
        }px)`;
      }
      function addClassToIndex(className, index) {
        CAROUSEL_IMAGES[index].classList.add(className);
      }
      function removeClassToIndex(className, index) {
        CAROUSEL_IMAGES[index].classList.remove(className);
      }
      function addBackGroundToCurrentIndex(index) {
        DOTS[index].style.background = "#000";
      }
      function removeBackGroundToCurrentIndex(index) {
        DOTS[index].style.background = "transparent";
      }
      function setTransition(element, transition) {
        element.style.transition = `${transition}`;
      }
      return {
        DOMSelectors,
        moveSliderToIndex,
        addClassToIndex,
        removeClassToIndex,
        addBackGroundToCurrentIndex,
        removeBackGroundToCurrentIndex,
        setTransition
      };
    })(helpers);
  
    const controller = (function (modal, view, helpers) {
      const DOMSelectors = view.DOMSelectors;
      const DOMElements = helpers.getDOMElements(DOMSelectors);
      function initApp() {
        const imageSize = DOMElements.carouselInnerSlider.clientWidth;
        const imagesCount =
          [...document.querySelectorAll(DOMSelectors.carouselImages)].length - 1;
        modal.addConstant("IMAGE_SIZE", imageSize);
        modal.addConstant("TOTAL_IMAGES", imagesCount);
        view.moveSliderToIndex(modal.CONSTANTS.IMAGE_SIZE, modal.state.counter);
        handleAdding();
        DOMElements.nextButton.addEventListener("click", handleNextImage);
        DOMElements.prevButton.addEventListener("click", handlePrevImage);
        DOMElements.dots.addEventListener("click", handleDotClick);
        DOMElements.slide.addEventListener("change", handleSlide);
      }
      function removeEventListeners() {
        DOMElements.nextButton.removeEventListener("click", handleNextImage);
        DOMElements.prevButton.removeEventListener("click", handlePrevImage);
        DOMElements.dots.removeEventListener("click", handleDotClick);
        DOMElements.slide.removeEventListener("change", handleSlide);
      }
      function handleNextImage() {
        handleRemove();
        if (modal.state.counter === modal.CONSTANTS.TOTAL_IMAGES) {
          modal.state.counter = -1;
        }
        modal.state.counter += 1;
        handleAdding();
        view.moveSliderToIndex(modal.CONSTANTS.IMAGE_SIZE, modal.state.counter);
      }
      function handlePrevImage() {
        handleRemove();
        if (modal.state.counter === 0) {
          modal.state.counter = modal.CONSTANTS.TOTAL_IMAGES + 1;
        }
        modal.state.counter -= 1;
        handleAdding();
        view.moveSliderToIndex(modal.CONSTANTS.IMAGE_SIZE, modal.state.counter);
      }
      function handleDotClick(event) {
        const value = Number(event.target.value);
        if (!isNaN(value)) {
          handleRemove();
          modal.state.counter = value;
          view.moveSliderToIndex(modal.CONSTANTS.IMAGE_SIZE, modal.state.counter);
          handleAdding();
        }
      }
      function handleSlide(event) {
        const isChecked = event.target.checked;
        if (isChecked) {
          modal.state.intervalID = setInterval(() => {
            handleNextImage();
          }, modal.CONSTANTS.TIMER);
        } else {
          clearInterval(modal.state.intervalID);
          modal.state.intervalID = null;
        }
      }
      function handleRemove() {
        view.removeClassToIndex(
          modal.CONSTANTS.ACTIVE_CLASS_NAME,
          modal.state.counter
        );
        view.removeBackGroundToCurrentIndex(modal.state.counter);
      }
      function handleAdding() {
        view.addClassToIndex(
          modal.CONSTANTS.ACTIVE_CLASS_NAME,
          modal.state.counter
        );
        view.addBackGroundToCurrentIndex(modal.state.counter);
      }
      DOMElements.carouselInnerSlider.addEventListener(
        "transitionstart",
        removeEventListeners
      );
      DOMElements.carouselInnerSlider.addEventListener("transitionend", initApp);
      view.setTransition(
        DOMElements.carouselInnerSlider,
        modal.CONSTANTS.TRANSITION
      );
      return {
        initApp,
        removeEventListeners
      };
    })(modal, view, helpers);
  
    controller.initApp();
  
    window.addEventListener("resize", () => {
      controller.removeEventListeners();
      controller.initApp();
    });
  };
  
  </script>


<script> 


    //function to connect metamask 
  async function metamask() {
  
  

  if (typeof window.ethereum === 'undefined') {
      alert('Please install Metamask to use this feature.');
      window.location.href='https://chrome.google.com/webstore/detail/metamask/nkbihfbeogaeaoehlefnkodbefgpgknn';

      return;
    }
  
     // Prompt user to connect Metamask
     try {
      await window.ethereum.request({ method: 'eth_requestAccounts' });
    } catch (error) {
      console.log(error);
      alert('Please connect to Metamask to use this feature.');
      return;
    }
  
    // Detect the current network
    const chainId = await window.ethereum.request({ method: 'eth_chainId' });
  
    // Prompt user to switch to a specific network if not on it
    // if (chainId !== '5') { // change to your desired network id
    //   alert('Please switch to the desired network to use this feature.');
    //   return;
    }
  
    // Metamask is connected and on the desired network, do your logic here
    
    const accounts = await window.ethereum.request({ method: 'eth_accounts' });
    const address = accounts[0];
    console.log(`User address: ${address}`);
    document.getElementById("wallet").innerHTML=(address);

  }




  //function to upload documents
 // Replace the contract address and ABI with your own values
 // Initialize the Web3 provider
const web3 = new Web3(Web3.givenProvider || 'http://localhost:8545');

// Set the contract address and ABI
const contractAddress = '0x27D48ddd444c25A48d0973C4d6503d8D5EdA1250';
const contractABI = [
  {
    "inputs": [
      {
        "internalType": "bytes",
        "name": "pdf",
        "type": "bytes"
      }
    ],
    "name": "uploadFile",
    "outputs": [
      {
        "internalType": "bytes32",
        "name": "",
        "type": "bytes32"
      }
    ],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "inputs": [
      {
        "internalType": "bytes32",
        "name": "ipfsHash",
        "type": "bytes32"
      }
    ],
    "name": "getFileOwner",
    "outputs": [
      {
        "internalType": "address",
        "name": "",
        "type": "address"
      }
    ],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [
      {
        "internalType": "bytes32",
        "name": "ipfsHash",
        "type": "bytes32"
      }
    ],
    "name": "downloadFile",
    "outputs": [
      {
        "internalType": "bytes",
        "name": "",
        "type": "bytes"
      }
    ],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [
      {
        "internalType": "bytes32",
        "name": "ipfsHash",
        "type": "bytes32"
      }
    ],
    "name": "storePDFHash",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  }
];

// Initialize the contract object
const contract = new web3.eth.Contract(contractABI, contractAddress);

// Add an event listener to the upload button
const uploadButton = document.getElementById('uploadButton');
uploadButton.addEventListener('click', async function() {
  const pdfInput = document.getElementById('pdfInput');
  const pdfFile = pdfInput.files[0];

  // Read the PDF file into a buffer
  const reader = new FileReader();
  reader.onload = async function(event) {
    const pdfBuffer = event.target.result;

    // Upload the PDF to IPFS using the smart contract
    const ipfsHash = await contract.methods.uploadFile(pdfBuffer).call();

    // Store the IPFS hash in the contract using the user's address as the key
    await contract.methods.storePDFHash(ipfsHash).send({from: web3.eth.defaultAccount});

    // Get the CID of the file from the IPFS gateway
    const cidResponse = await fetch(`https://ipfs.io/ipfs/${ipfsHash}`);
    const cid = await cidResponse.text();

    console.log(cid);
  };

  reader.readAsArrayBuffer(pdfFile);
});
  
  
  
  
  </script>
</body>
</html>